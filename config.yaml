kind: Config
apiVersion: atlas2crd.mongodb.com/v1alpha1

spec:
  openapi:
    - name: v20250312
      path: atlas-api-transformed-v20250312002.0.0.yaml

    - name: v20231115
      path: atlas-api-transformed-v20231115.yaml

    - name: v20241113
      path: atlas-api-transformed-v20241113.yaml

  crd:
    - gvk:
        version: v1
        kind: Group
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - ag
      mappings:
        - majorVersion: v20231115
          openAPIRef:
            name: v20231115
          parameters:
            path:
              name: '/api/atlas/v2/groups'
              verb: post
          entry:
            schema: "Group"
            filters:
              skipProperties:
                - $.clusterCount
                - $.created
                - $.id
                - $.links
          status:
            schema: "Group"
            filters:
              skipProperties:
                - $.links
                - $.name
                - $.orgId
                - $.regionUsageRestrictions
                - $.tags
                - $.withDefaultAlertsSettings

    - gvk:
        version: v1
        kind: NetworkPermissionEntries
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - anp
      mappings:
        - majorVersion: v20250312
          openAPIRef:
            name: v20250312
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/accessList'
              verb: post
          entry:
            path:
              name: '/api/atlas/v2/groups/{groupId}/accessList'
              verb: post
              requestBody:
                mimeType: 'application/vnd.atlas.2023-01-01+json'
            filters:
              skipProperties:
                - $[*].groupId
                - $[*].links
          status:
            schema: 'NetworkPermissionEntry'
            filters:
              skipProperties:
                - $.cidrBlock
                - $.comment
                - $.deleteAfterDate
                - $.awsSecurityGroup
                - $.links
                - $.ipAddress

    - gvk:
        version: v1
        kind: Cluster
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - ac
      mappings:
        - majorVersion: v20231115
          openAPIRef:
            name: v20231115
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/clusters'
              verb: post
          entry:
            schema: 'AdvancedClusterDescription'
            filters:
              skipProperties:
                - $.connectionStrings
                - $.createDate
                - $.groupId
                - $.id
                - $.links
                - $.mongoDBVersion
                - $.replicationSpecs[*].id
                - $.stateName
          status:
            schema: 'AdvancedClusterDescription'
            filters:
              skipProperties:
                - $.acceptDataRisksAndForceReplicaSetReconfig
                - $.backupEnabled
                - $.biConnector
                - $.clusterType
                - $.diskSizeGB
                - $.diskWarmingMode
                - $.encryptionAtRestProvider
                - $.labels
                - $.links
                - $.mongoDBMajorVersion
                - $.name
                - $.paused
                - $.pitEnabled
                - $.replicationSpecs[*].numShards
                - $.replicationSpecs[*].regionConfigs
                - $.replicationSpecs[*].zoneName
                - $.rootCertType
                - $.tags
                - $.terminationProtectionEnabled
                - $.versionReleaseSystem

    - gvk:
        version: v1
        kind: SearchIndex
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - asi
      mappings:
        - majorVersion: v20231115
          openAPIRef:
            name: v20231115
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/clusters/{clusterName}/fts/indexes'
              verb: post
          entry:
            schema: 'ClusterSearchIndex'
            filters:
              skipProperties:
                - $.indexID
                - $.status
          status:
            schema: 'ClusterSearchIndex'
            filters:
              skipProperties:
                - $.analyzer
                - $.analyzers
                - $.collectionName
                - $.database
                - $.fields
                - $.mappings
                - $.name
                - $.searchAnalyzer
                - $.storedSource
                - $.synonyms
                - $.type

    - gvk:
        version: v1
        kind: UserCustomDBRole
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - arole
      mappings:
        - majorVersion: v20231115
          openAPIRef:
            name: v20231115
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/customDBRoles/roles'
              verb: post
          entry:
            schema: 'UserCustomDBRole'

    - gvk:
        version: v1
        kind: FlexCluster
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - afc
      mappings:
        - majorVersion: v20241113
          openAPIRef:
            name: v20241113
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/flexClusters'
              verb: post
          entry:
            schema: 'FlexClusterDescriptionCreate20241113'
            filters:
              skipProperties:
                - $.links
                - $.providerSettings.diskSizeGB
                - $.providerSettings.providerName
          status:
            schema: 'FlexClusterDescription20241113'
            filters:
              skipProperties:
                - $.links
                - $.tags
                - $.terminationProtectionEnabled

    - gvk:
        version: v1
        kind: GroupAlertsConfig
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - aga
      mappings:
        - majorVersion: v20241113
          openAPIRef:
            name: v20241113
          parameters: # POST parameters
            path:
              name: '/api/atlas/v2/groups/{groupId}/alertConfigs'
              verb: post
          entry: # POST/PATCH schema
            schema: 'GroupAlertsConfig'
            filters:
              skipProperties:
                - $.created
                - $.groupId
                - $.id
                - $.links
                - $.updated
              sensitiveProperties:
                - $.notifications[*].webhookUrl
                - $.notifications[*].apiToken
                - $.notifications[*].webhookSecret
                - $.notifications[*].victorOpsRoutingKey
                - $.notifications[*].notificationToken
                - $.notifications[*].serviceKey
                - $.notifications[*].victorOpsApiKey
                - $.notifications[*].datadogApiKey
                - $.notifications[*].microsoftTeamsWebhookUrl
                - $.notifications[*].opsGenieApiKey
          status: # GET schema
            schema: 'GroupAlertsConfig'
            filters:
              skipProperties:
                - $.enabled
                - $.eventTypeName
                - $.links
                - $.matchers
                - $.notifications
                - $.metricThreshold
                - $.threshold
          extensions:
            - property: $.spec.v20241113.groupRef
              x-openapi-mapping:
                property: .groupId
                type: string
              x-kubernetes-mapping:
                gvr: groups.atlas.generated.mongodb.com/v1
                nameSelector: .name
                properties:
                  - $.status.v20250312.groupId

    - gvk:
        version: v1
        kind: ThirdPartyIntegration
        group: atlas.generated.mongodb.com
      categories:
        - atlas
      shortNames:
        - atpi
      mappings:
        - majorVersion: v20241113
          openAPIRef:
            name: v20241113
          parameters:
            path:
              name: '/api/atlas/v2/groups/{groupId}/integrations/{integrationType}'
              verb: post
          entry:
            schema: "ThirdPartyIntegration"
            filters:
              skipProperties:
                - $.id
              sensitiveProperties:
                - $.apiKey
                - $.apiToken
                - $.licenseKey
                - $.microsoftTeamsWebhookUrl
                - $.password
                - $.readToken
                - $.routingKey
                - $.secret
                - $.serviceKey
                - $.url
                - $.writeToken
          status:
            schema: "ThirdPartyIntegration"
            filters:
              skipProperties:
                - $.accountId
                - $.apiKey
                - $.apiToken
                - $.channelName
                - $.enabled
                - $.licenseKey
                - $.microsoftTeamsWebhookUrl
                - $.password
                - $.readToken
                - $.region
                - $.routingKey
                - $.secret
                - $.serviceKey
                - $.serviceDiscovery
                - $.teamName
                - $.url
                - $.username
                - $.writeToken
